CMAKE_MINIMUM_REQUIRED(VERSION 3.2)
PROJECT(v8)

INCLUDE_DIRECTORIES(BEFORE ${CMAKE_CURRENT_SOURCE_DIR}/src)
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/include)
ADD_DEFINITIONS(-DENABLE_DEBUGGER_SUPPORT)
ADD_LIBRARY(v8_base STATIC
            src/accessors.cc
            src/accessors.h
            src/allocation.cc
            src/allocation.h
            src/api.cc
            src/api.h
            src/apiutils.h
            src/arguments.h
            src/assembler.cc
            src/assembler.h
            src/ast.cc
            src/ast.h
            src/atomicops.h
            src/atomicops_internals_x86_gcc.cc
            src/bignum-dtoa.cc
            src/bignum-dtoa.h
            src/bignum.cc
            src/bignum.h
            src/bootstrapper.cc
            src/bootstrapper.h
            src/builtins.cc
            src/builtins.h
            src/bytecodes-irregexp.h
            src/cached-powers.cc
            src/cached-powers.h
            src/char-predicates-inl.h
            src/char-predicates.h
            src/checks.cc
            src/checks.h
            src/circular-queue-inl.h
            src/circular-queue.cc
            src/circular-queue.h
            src/code-stubs.cc
            src/code-stubs.h
            src/code.h
            src/codegen.cc
            src/codegen.h
            src/compilation-cache.cc
            src/compilation-cache.h
            src/compiler.cc
            src/compiler.h
            src/contexts.cc
            src/contexts.h
            src/conversions-inl.h
            src/conversions.cc
            src/conversions.h
            src/counters.cc
            src/counters.h
            src/cpu-profiler-inl.h
            src/cpu-profiler.cc
            src/cpu-profiler.h
            src/cpu.h
            src/data-flow.cc
            src/data-flow.h
            src/date.cc
            src/date.h
            src/dateparser-inl.h
            src/dateparser.cc
            src/dateparser.h
            src/debug-agent.cc
            src/debug-agent.h
            src/debug.cc
            src/debug.h
            src/deoptimizer.cc
            src/deoptimizer.h
            src/disasm.h
            src/disassembler.cc
            src/disassembler.h
            src/diy-fp.cc
            src/diy-fp.h
            src/double.h
            src/dtoa.cc
            src/dtoa.h
            src/elements-kind.cc
            src/elements-kind.h
            src/elements.cc
            src/elements.h
            src/execution.cc
            src/execution.h
            src/extensions/externalize-string-extension.cc
            src/extensions/externalize-string-extension.h
            src/extensions/gc-extension.cc
            src/extensions/gc-extension.h
            src/extensions/statistics-extension.cc
            src/extensions/statistics-extension.h
            src/factory.cc
            src/factory.h
            src/fast-dtoa.cc
            src/fast-dtoa.h
            src/fixed-dtoa.cc
            src/fixed-dtoa.h
            src/flag-definitions.h
            src/flags.cc
            src/flags.h
            src/frames-inl.h
            src/frames.cc
            src/frames.h
            src/full-codegen.cc
            src/full-codegen.h
            src/func-name-inferrer.cc
            src/func-name-inferrer.h
            src/gdb-jit.cc
            src/gdb-jit.h
            src/global-handles.cc
            src/global-handles.h
            src/globals.h
            src/handles-inl.h
            src/handles.cc
            src/handles.h
            src/hashmap.h
            src/heap-inl.h
            src/heap-profiler.cc
            src/heap-profiler.h
            src/heap.cc
            src/heap.h
            src/hydrogen-instructions.cc
            src/hydrogen-instructions.h
            src/hydrogen.cc
            src/hydrogen.h
            src/ic-inl.h
            src/ic.cc
            src/ic.h
            src/incremental-marking.cc
            src/incremental-marking.h
            src/inspector.cc
            src/inspector.h
            src/interface.cc
            src/interface.h
            src/interpreter-irregexp.cc
            src/interpreter-irregexp.h
            src/isolate.cc
            src/isolate.h
            src/json-parser.h
            src/jsregexp.cc
            src/jsregexp.h
            src/lazy-instance.h
            src/list-inl.h
            src/list.h
            src/lithium-allocator-inl.h
            src/lithium-allocator.cc
            src/lithium-allocator.h
            src/lithium.cc
            src/lithium.h
            src/liveedit.cc
            src/liveedit.h
            src/liveobjectlist-inl.h
            src/liveobjectlist.cc
            src/liveobjectlist.h
            src/log-inl.h
            src/log-utils.cc
            src/log-utils.h
            src/log.cc
            src/log.h
            src/macro-assembler.h
            src/mark-compact.cc
            src/mark-compact.h
            src/messages.cc
            src/messages.h
            src/natives.h
            src/objects-debug.cc
            src/objects-inl.h
            src/objects-printer.cc
            src/objects-visiting.cc
            src/objects-visiting.h
            src/objects.cc
            src/objects.h
            src/once.cc
            src/once.h
            src/optimizing-compiler-thread.h
            src/optimizing-compiler-thread.cc
            src/parser.cc
            src/parser.h
            src/platform-posix.h
            src/platform-tls-mac.h
            src/platform-tls-win32.h
            src/platform-tls.h
            src/platform.h
            src/preparse-data-format.h
            src/preparse-data.cc
            src/preparse-data.h
            src/preparser.cc
            src/preparser.h
            src/prettyprinter.cc
            src/prettyprinter.h
            src/profile-generator-inl.h
            src/profile-generator.cc
            src/profile-generator.h
            src/property-details.h
            src/property.cc
            src/property.h
            src/regexp-macro-assembler-irregexp-inl.h
            src/regexp-macro-assembler-irregexp.cc
            src/regexp-macro-assembler-irregexp.h
            src/regexp-macro-assembler-tracer.cc
            src/regexp-macro-assembler-tracer.h
            src/regexp-macro-assembler.cc
            src/regexp-macro-assembler.h
            src/regexp-stack.cc
            src/regexp-stack.h
            src/rewriter.cc
            src/rewriter.h
            src/runtime-profiler.cc
            src/runtime-profiler.h
            src/runtime.cc
            src/runtime.h
            src/safepoint-table.cc
            src/safepoint-table.h
            src/scanner-character-streams.cc
            src/scanner-character-streams.h
            src/scanner.cc
            src/scanner.h
            src/scopeinfo.cc
            src/scopeinfo.h
            src/scopes.cc
            src/scopes.h
            src/serialize.cc
            src/serialize.h
            src/small-pointer-list.h
            src/smart-pointers.h
            src/snapshot-common.cc
            src/snapshot.h
            src/spaces-inl.h
            src/spaces.cc
            src/spaces.h
            src/store-buffer-inl.h
            src/store-buffer.cc
            src/store-buffer.h
            src/string-search.cc
            src/string-search.h
            src/string-stream.cc
            src/string-stream.h
            src/strtod.cc
            src/strtod.h
            src/stub-cache.cc
            src/stub-cache.h
            src/token.cc
            src/token.h
            src/transitions-inl.h
            src/transitions.cc
            src/transitions.h
            src/type-info.cc
            src/type-info.h
            src/unbound-queue-inl.h
            src/unbound-queue.h
            src/unicode-inl.h
            src/unicode.cc
            src/unicode.h
            src/utils-inl.h
            src/utils.cc
            src/utils.h
            src/v8-counters.cc
            src/v8-counters.h
            src/v8.cc
            src/v8.h
            src/v8checks.h
            src/v8conversions.cc
            src/v8conversions.h
            src/v8globals.h
            src/v8memory.h
            src/v8threads.cc
            src/v8threads.h
            src/v8utils.cc
            src/v8utils.h
            src/variables.cc
            src/variables.h
            src/version.cc
            src/version.h
            src/vm-state-inl.h
            src/vm-state.h
            src/zone-inl.h
            src/zone.cc
            src/zone.h

            #Mac IA32 sources

            src/ia32/assembler-ia32-inl.h
            src/ia32/assembler-ia32.cc
            src/ia32/assembler-ia32.h
            src/ia32/builtins-ia32.cc
            src/ia32/code-stubs-ia32.cc
            src/ia32/code-stubs-ia32.h
            src/ia32/codegen-ia32.cc
            src/ia32/codegen-ia32.h
            src/ia32/cpu-ia32.cc
            src/ia32/debug-ia32.cc
            src/ia32/deoptimizer-ia32.cc
            src/ia32/disasm-ia32.cc
            src/ia32/frames-ia32.cc
            src/ia32/frames-ia32.h
            src/ia32/full-codegen-ia32.cc
            src/ia32/ic-ia32.cc
            src/ia32/lithium-codegen-ia32.cc
            src/ia32/lithium-codegen-ia32.h
            src/ia32/lithium-gap-resolver-ia32.cc
            src/ia32/lithium-gap-resolver-ia32.h
            src/ia32/lithium-ia32.cc
            src/ia32/lithium-ia32.h
            src/ia32/macro-assembler-ia32.cc
            src/ia32/macro-assembler-ia32.h
            src/ia32/regexp-macro-assembler-ia32.cc
            src/ia32/regexp-macro-assembler-ia32.h
            src/ia32/stub-cache-ia32.cc

            #Mac x64 sources

            src/x64/assembler-x64-inl.h
            src/x64/assembler-x64.cc
            src/x64/assembler-x64.h
            src/x64/builtins-x64.cc
            src/x64/code-stubs-x64.cc
            src/x64/code-stubs-x64.h
            src/x64/codegen-x64.cc
            src/x64/codegen-x64.h
            src/x64/cpu-x64.cc
            src/x64/debug-x64.cc
            src/x64/deoptimizer-x64.cc
            src/x64/disasm-x64.cc
            src/x64/frames-x64.cc
            src/x64/frames-x64.h
            src/x64/full-codegen-x64.cc
            src/x64/ic-x64.cc
            src/x64/lithium-codegen-x64.cc
            src/x64/lithium-codegen-x64.h
            src/x64/lithium-gap-resolver-x64.cc
            src/x64/lithium-gap-resolver-x64.h
            src/x64/lithium-x64.cc
            src/x64/lithium-x64.h
            src/x64/macro-assembler-x64.cc
            src/x64/macro-assembler-x64.h
            src/x64/regexp-macro-assembler-x64.cc
            src/x64/regexp-macro-assembler-x64.h
            src/x64/stub-cache-x64.cc

            #Mac sources
            src/platform-macos.cc
            src/platform-posix.cc

            #Postmortem debug
            ${CMAKE_CURRENT_BINARY_DIR}/debug-support.cc
)

SET(v8_library_files
    ${CMAKE_CURRENT_SOURCE_DIR}/src/runtime.js
    ${CMAKE_CURRENT_SOURCE_DIR}/src/v8natives.js
    ${CMAKE_CURRENT_SOURCE_DIR}/src/array.js
    ${CMAKE_CURRENT_SOURCE_DIR}/src/string.js
    ${CMAKE_CURRENT_SOURCE_DIR}/src/uri.js
    ${CMAKE_CURRENT_SOURCE_DIR}/src/math.js
    ${CMAKE_CURRENT_SOURCE_DIR}/src/messages.js
    ${CMAKE_CURRENT_SOURCE_DIR}/src/apinatives.js
    ${CMAKE_CURRENT_SOURCE_DIR}/src/debug-debugger.js
    ${CMAKE_CURRENT_SOURCE_DIR}/src/mirror-debugger.js
    ${CMAKE_CURRENT_SOURCE_DIR}/src/liveedit-debugger.js
    ${CMAKE_CURRENT_SOURCE_DIR}/src/date.js
    ${CMAKE_CURRENT_SOURCE_DIR}/src/json.js
    ${CMAKE_CURRENT_SOURCE_DIR}/src/regexp.js
    ${CMAKE_CURRENT_SOURCE_DIR}/src/macros.py
)
            
SET(v8_experimental_library_files
    ${CMAKE_CURRENT_SOURCE_DIR}/src/macros.py
    ${CMAKE_CURRENT_SOURCE_DIR}/src/proxy.js
    ${CMAKE_CURRENT_SOURCE_DIR}/src/collection.js
)

ADD_CUSTOM_COMMAND(OUTPUT libraries.cc COMMAND python ${CMAKE_CURRENT_SOURCE_DIR}/tools/js2c.py ${CMAKE_CURRENT_BINARY_DIR}/libraries.cc CORE off ${v8_library_files})
ADD_CUSTOM_COMMAND(OUTPUT experimental-libraries.cc COMMAND python ${CMAKE_CURRENT_SOURCE_DIR}/tools/js2c.py ${CMAKE_CURRENT_BINARY_DIR}/experimental-libraries.cc EXPERIMENTAL off ${v8_experimental_library_files})

ADD_LIBRARY(v8_nosnapshot STATIC
    ${CMAKE_CURRENT_BINARY_DIR}/libraries.cc
    ${CMAKE_CURRENT_BINARY_DIR}/experimental-libraries.cc
    src/snapshot-empty.cc
)

SET(v8_heapobject_files
    ${CMAKE_CURRENT_SOURCE_DIR}/src/objects.h
    ${CMAKE_CURRENT_SOURCE_DIR}/src/objects-inl.h
)

ADD_CUSTOM_COMMAND(OUTPUT debug-support.cc COMMAND python ${CMAKE_CURRENT_SOURCE_DIR}/tools/gen-postmortem-metadata.py ${CMAKE_CURRENT_BINARY_DIR}/debug-support.cc ${v8_heapobject_files})
